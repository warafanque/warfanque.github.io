# 使用指南 - 球体Gouraud光照模型

## 快速开始

### 1. 打开项目
1. 启动 **Visual Studio 2022**
2. 选择 **文件 > 打开 > 项目/解决方案**
3. 浏览到项目文件夹，选择 `SphereGouraud.sln`

### 2. 构建项目
1. 确保选择了正确的配置：
   - 配置：**Debug** 或 **Release**
   - 平台：**x64** (推荐) 或 **Win32**
2. 按 **F7** 或选择 **生成 > 生成解决方案**

### 3. 运行程序
1. 按 **F5** (调试运行) 或 **Ctrl+F5** (不调试运行)
2. 程序窗口将显示一个3D球体

## 功能说明

### 界面布局
- **标题栏**: 显示"球体Gouraud光照模型"
- **工具按钮**: 顶部有一个"动画"按钮
- **渲染区域**: 显示3D球体的主要区域（深红色背景）

### 控制方式

#### 键盘控制
使用方向键旋转球体：
- **← 左箭头**: 向左旋转球体（绕Y轴）
- **→ 右箭头**: 向右旋转球体（绕Y轴）
- **↑ 上箭头**: 向上旋转球体（绕X轴）
- **↓ 下箭头**: 向下旋转球体（绕X轴）

#### 动画控制
- 点击"**动画**"按钮开始自动旋转
- 按钮文字变为"**停止**"
- 再次点击停止动画
- 动画速度：约60帧/秒

## 技术特性

### 光照效果
- **光照模型**: Gouraud着色（顶点着色插值）
- **光源位置**: 球体右上方 (300, 400, 500)
- **光照成分**:
  - 环境光 (Ambient): 20% 强度
  - 漫反射光 (Diffuse): 根据法向量和光线方向计算
  - 镜面反射光 (Specular): Blinn-Phong模型，光泽度32

### 渲染技术
- **消隐算法**: Z-Buffer深度缓冲
- **背面剔除**: 自动剔除不可见的三角形
- **球体细分**: 
  - 纬度分段：30段
  - 经度分段：40段
  - 总三角形数：约2400个

### 坐标系统
- **原点**: 屏幕客户区中心
- **X轴**: 水平向右为正
- **Y轴**: 垂直向上为正
- **Z轴**: 垂直屏幕向外为正（右手坐标系）

## 常见问题

### Q1: 编译时提示"找不到MFC库"
**A**: 需要在Visual Studio安装程序中安装"使用C++的桌面开发"工作负载，并确保选中了"MFC"组件。

### Q2: 球体显示不完整或有闪烁
**A**: 这可能是由于：
1. 显示器刷新率问题 - 正常现象
2. Z-Buffer精度问题 - 可以调整`SPHERE_RADIUS`常量

### Q3: 键盘控制不响应
**A**: 确保程序窗口获得了焦点。点击窗口任意位置以激活。

### Q4: 动画播放卡顿
**A**: 
1. 关闭其他占用CPU的程序
2. 使用Release配置编译以提高性能
3. 可以修改`SetTimer(1, 16, NULL)`中的16为更大值（降低帧率）

## 自定义修改

### 修改球体半径
在 `SphereGouraudDlg.cpp` 中修改：
```cpp
const double SPHERE_RADIUS = 200.0;  // 改为你想要的值
```

### 修改细分精度
在 `SphereGouraudDlg.cpp` 中修改：
```cpp
const int SPHERE_SEGMENTS_LAT = 30;  // 纬度分段
const int SPHERE_SEGMENTS_LON = 40;  // 经度分段
```
注意：增加分段数会提高质量但降低性能。

### 修改背景颜色
在 `SphereGouraudDlg.cpp` 的 `OnPaint()` 函数中修改：
```cpp
memDC.FillSolidRect(0, 0, rect.Width(), renderHeight, RGB(128, 0, 0));
```
将 `RGB(128, 0, 0)` 改为你想要的颜色。

### 修改光源位置
在 `SphereGouraudDlg.cpp` 构造函数中修改：
```cpp
m_lightPos = Vector3(300.0, 400.0, 500.0);  // (X, Y, Z)
```

### 修改材质属性
在 `SphereGouraudDlg.cpp` 构造函数中修改：
```cpp
m_ambientColor = Vector3(0.2, 0.2, 0.2);    // 环境光反射率
m_diffuseColor = Vector3(0.8, 0.6, 0.4);    // 漫反射颜色
m_specularColor = Vector3(1.0, 1.0, 1.0);   // 镜面反射颜色
m_shininess = 32.0;                          // 光泽度
```

## 性能优化建议

### 提高渲染速度
1. 使用 **Release** 配置编译
2. 减少球体分段数（降低 `SPHERE_SEGMENTS_LAT` 和 `SPHERE_SEGMENTS_LON`）
3. 启用编译器优化选项

### 提高视觉质量
1. 增加球体分段数
2. 添加更多光源
3. 实现更复杂的光照模型（如Phong着色）

## 扩展功能建议

可以尝试添加以下功能：
- [ ] 鼠标拖拽旋转
- [ ] 滚轮缩放
- [ ] 多个光源
- [ ] 材质选择（金属、塑料等）
- [ ] 导出为图片
- [ ] 截图功能
- [ ] 实时调整参数的控制面板

## 技术支持

如有问题，请检查：
1. Visual Studio版本是否为2022或更高
2. 是否正确安装了MFC组件
3. Windows SDK版本是否兼容
4. 项目配置是否正确

## 实验报告建议

编写实验报告时，可以包括：
1. **原理介绍**: Gouraud着色、Z-Buffer算法
2. **实现细节**: 球体生成、坐标变换、光照计算
3. **运行截图**: 不同角度的球体、动画效果
4. **性能分析**: 帧率、三角形数量等
5. **改进建议**: 可能的优化方向

## 参考资料

- Gouraud Shading: 顶点光照插值技术
- Z-Buffer Algorithm: 深度缓冲消隐算法
- Blinn-Phong Reflection Model: 镜面反射模型
- Spherical Coordinates: 球坐标系统
